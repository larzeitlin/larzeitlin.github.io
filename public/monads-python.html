<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LZ</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type= "text/css" href="./htmlize.css"><link rel="stylesheet" type= "text/css" href="./styles.css"><link rel="icon"
       href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘»</text></svg>"><header>
| <a href="./">home</a>
| <a href="#top">top</a>
| <a href="https://github.com/larzeitlin">github</a>
|
</header>
</head>
<body>
<div id="content" class="content">
<h1 class="title">LZ</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org836fcc2">Implementing Monads in Python</a>
<ul>
<li><a href="#org176b9ad">What is a monad?</a></li>
<li><a href="#org3957b36">The non-monadic way</a></li>
<li><a href="#org500d486">Higher order functions</a></li>
<li><a href="#org65ed7f9">New capabilities</a></li>
<li><a href="#orgb9b10a5">Just DRY it up a bit</a></li>
<li><a href="#org2fb5b34">monaDONE</a></li>
<li><a href="#org22315b7">Maybe monad</a></li>
<li><a href="#org5b153fa">Monad laws</a>
<ul>
<li><a href="#org7868c51">ret is a left-identity for bind</a></li>
<li><a href="#org6bfc21e">ret is also a right-identity for bind</a></li>
<li><a href="#org4e7d762">bind is associative</a></li>
</ul>
</li>
<li><a href="#org4c0b91a">Objections</a>
<ul>
<li><a href="#org6eee175">This is still more complicated than just adding those extra capabilities by hand</a></li>
<li><a href="#orge03fdf4">This is not pythonicâ„¢</a></li>
</ul>
</li>
<li><a href="#org0d602b5">What else can it do?</a></li>
<li><a href="#org76e9574">Functional Python</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org836fcc2" class="outline-2">
<h2 id="org836fcc2">Implementing Monads in Python</h2>
<div class="outline-text-2" id="text-org836fcc2">
<p>
The idea of this article is to explain the intuition for monads using higher-order functions as the main building blocks. I decided to do it in Python becuase it's not a "functional" language.
</p>

<p>
I'm not saying you should write Python like this, I'm just saying that you could, and if you did you would be monad-ing.
</p>
</div>
<div id="outline-container-org176b9ad" class="outline-3">
<h3 id="org176b9ad">What is a monad?</h3>
<div class="outline-text-3" id="text-org176b9ad">
<p>
We will learn by doing rather than dry definitions, but as a bit of colour to start with: Monads are a functional programming design pattern used to reduce boilerplate code and abstract away side-effects, among other things. It comes from a field of maths called Category Theory which has seeded many concepts found in functional programming.
</p>
</div>
</div>
<div id="outline-container-org3957b36" class="outline-3">
<h3 id="org3957b36">The non-monadic way</h3>
<div class="outline-text-3" id="text-org3957b36">
<p>
Let's start with some primitive value in Python; a number or string or whatever. Now, we could pass around that value, do things to it, pass it around some more. Great. 
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-py-variable-name">my_message</span> <span class="org-operator">=</span> <span class="org-string">"hello"</span>
<span class="org-py-variable-name">another_message</span> <span class="org-operator">=</span> my_message + <span class="org-string">", world"</span>
<span class="org-py-variable-name">uppercase_msg</span> <span class="org-operator">=</span> another_message.upper<span class="org-rainbow-delimiters-depth-1">()</span>

<span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span>uppercase_msg<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">HELLO, WORLD
</pre>
</div>
</div>
</div>
<div id="outline-container-org500d486" class="outline-3">
<h3 id="org500d486">Higher order functions</h3>
<div class="outline-text-3" id="text-org500d486">
<p>
We can make higher order functions in Python. That is to say functions that return functions. So, rather than passing around that value, we could instead wrap it up in a function that returns that value and then instead pass around that function to other custom functions that handle it. These functions can also return functions rather than the value itself. 
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-py-def-class">def</span> <span class="org-py-def">my_message_fn</span><span class="org-rainbow-delimiters-depth-1">()</span>:
  <span class="org-keyword">return</span> <span class="org-string">"hello"</span>

<span class="org-py-def-class">def</span> <span class="org-py-def">another_message_fn</span><span class="org-rainbow-delimiters-depth-1">(</span>message_fn<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-def-class">def</span> <span class="org-py-def">new_msg_fn</span><span class="org-rainbow-delimiters-depth-1">()</span>:
    <span class="org-keyword">return</span> message_fn<span class="org-rainbow-delimiters-depth-1">()</span> + <span class="org-string">", world"</span>
  <span class="org-keyword">return</span> new_msg_fn

<span class="org-py-def-class">def</span> <span class="org-py-def">to_uppercase_fn</span><span class="org-rainbow-delimiters-depth-1">(</span>message_fn<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-def-class">def</span> <span class="org-py-def">new_msg_fn</span><span class="org-rainbow-delimiters-depth-1">()</span>:
    <span class="org-keyword">return</span> message_fn<span class="org-rainbow-delimiters-depth-1">()</span>.upper<span class="org-rainbow-delimiters-depth-1">()</span>
  <span class="org-keyword">return</span> new_msg_fn

<span class="org-py-variable-name">result</span> <span class="org-operator">=</span> to_uppercase_fn<span class="org-rainbow-delimiters-depth-1">(</span>another_message_fn<span class="org-rainbow-delimiters-depth-2">(</span>my_message_fn<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span>result<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">HELLO, WORLD
</pre>
</div>

<p>
Easy enough, but we've just created a bunch of extra faff to do the same thing. "What gives?".
</p>

<p>
A couple of things give. Firstly, our functions returned the message, but it could have done some other stuff as well. Perhaps some side-effect like logging. So maybe that's useful. Also, we could delay evaluation of some extra behavior inside <code>my_message_fn</code>, so that it is only run once function is finally called. We could also add other extra capabilities that the primitive string doesn't have, like handling <code>None</code> values in some special way.
</p>
</div>
</div>
<div id="outline-container-org65ed7f9" class="outline-3">
<h3 id="org65ed7f9">New capabilities</h3>
<div class="outline-text-3" id="text-org65ed7f9">
<div class="org-src-container">
<pre class="src src-python"><span class="org-py-def-class">def</span> <span class="org-py-def">my_message_fn</span><span class="org-rainbow-delimiters-depth-1">()</span>:
  <span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"delayed evaluation"</span><span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-keyword">return</span> <span class="org-string">"hello"</span>

<span class="org-py-def-class">def</span> <span class="org-py-def">another_message_fn</span><span class="org-rainbow-delimiters-depth-1">(</span>message_fn<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"inside another_message_fn"</span><span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-py-def-class">def</span> <span class="org-py-def">new_msg_fn</span><span class="org-rainbow-delimiters-depth-1">()</span>:
    <span class="org-keyword">return</span> message_fn<span class="org-rainbow-delimiters-depth-1">()</span> + <span class="org-string">", world"</span>
  <span class="org-keyword">return</span> new_msg_fn

<span class="org-py-def-class">def</span> <span class="org-py-def">to_uppercase_fn</span><span class="org-rainbow-delimiters-depth-1">(</span>message_fn<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"inside to_uppercase_fn"</span><span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-py-def-class">def</span> <span class="org-py-def">new_msg_fn</span><span class="org-rainbow-delimiters-depth-1">()</span>:
    <span class="org-keyword">return</span> message_fn<span class="org-rainbow-delimiters-depth-1">()</span>.upper<span class="org-rainbow-delimiters-depth-1">()</span>
  <span class="org-keyword">return</span> new_msg_fn

<span class="org-py-variable-name">result</span> <span class="org-operator">=</span> to_uppercase_fn<span class="org-rainbow-delimiters-depth-1">(</span>another_message_fn<span class="org-rainbow-delimiters-depth-2">(</span>my_message_fn<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span>result<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">inside another_message_fn
inside to_uppercase_fn
delayed evaluation
HELLO, WORLD
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb9b10a5" class="outline-3">
<h3 id="orgb9b10a5">Just DRY it up a bit</h3>
<div class="outline-text-3" id="text-orgb9b10a5">
<p>
Still, it seems like a bit of a faff to get those benefits. It could be useful in some situations, but now all of our regular functions have to be rewritten to handle functions rather than strings. That is annoying and messy. Still, maybe we can avoid having to do it all over again each time with a couple of helper functions:
</p>
<ul class="org-ul">
<li>One to take a string and turn it into a function that contains that string. We'll call this one <code>ret</code>. (it would be called <code>return</code> but this is a special word in Python)</li>
<li>Another to take regular string functions and turn them into our special string functions. We'll call this one <code>bind</code>.</li>
</ul>

<p>
So, let's do that such that that we get the functions logged out when they are invoked.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-py-def-class">def</span> <span class="org-py-def">ret</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-def-class">def</span> <span class="org-py-def">monadic_value</span><span class="org-rainbow-delimiters-depth-1">()</span>:
    <span class="org-keyword">return</span> s
  <span class="org-keyword">return</span> monadic_value

<span class="org-py-def-class">def</span> <span class="org-py-def">bind</span><span class="org-rainbow-delimiters-depth-1">(</span>f<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-def-class">def</span> <span class="org-py-def">monadic_f</span><span class="org-rainbow-delimiters-depth-1">(</span>monadic_value<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-py-def-class">def</span> <span class="org-py-def">new_mv</span><span class="org-rainbow-delimiters-depth-1">()</span>:
      <span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"using function: "</span>, f<span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-keyword">return</span> f<span class="org-rainbow-delimiters-depth-1">(</span>monadic_value<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
    <span class="org-keyword">return</span> new_mv
  <span class="org-keyword">return</span> monadic_f

<span class="org-py-def-class">def</span> <span class="org-py-def">append_world</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-keyword">return</span> s + <span class="org-string">", world"</span>

<span class="org-py-def-class">def</span> <span class="org-py-def">to_uppercase</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-keyword">return</span> s.upper<span class="org-rainbow-delimiters-depth-1">()</span>

<span class="org-py-variable-name">mv</span> <span class="org-operator">=</span> ret<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"hello"</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-py-variable-name">m_append</span> <span class="org-operator">=</span> bind<span class="org-rainbow-delimiters-depth-1">(</span>append_world<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-py-variable-name">m_upper</span> <span class="org-operator">=</span> bind<span class="org-rainbow-delimiters-depth-1">(</span>to_uppercase<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-py-variable-name">result</span> <span class="org-operator">=</span> m_upper<span class="org-rainbow-delimiters-depth-1">(</span>m_append<span class="org-rainbow-delimiters-depth-2">(</span>mv<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span>result<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">using function:  &lt;function to_uppercase at 0x7ff382e46050&gt;
using function:  &lt;function append_world at 0x7ff382e457e0&gt;
HELLO, WORLD
</pre>
</div>
</div>
</div>
<div id="outline-container-org2fb5b34" class="outline-3">
<h3 id="org2fb5b34">monaDONE</h3>
<div class="outline-text-3" id="text-org2fb5b34">
<p>
And that's it, we just did a monad. For any given monad the <code>ret</code> and <code>bind</code> functions have to work together to handle the same sort of value.
</p>

<p>
Now, you can probably imagine doing this with types and objects in Python, and sure that works too. You'd have a class with a constructor rather than <code>ret</code> and a method or accessor that returns the original value, rather than just evaluating the function to get the result as we have been doing. I prefer just doing it with functions because it's simpler, clearer and more in the functional programming style.
</p>

<p>
Let's do another one.
</p>
</div>
</div>
<div id="outline-container-org22315b7" class="outline-3">
<h3 id="org22315b7">Maybe monad</h3>
<div class="outline-text-3" id="text-org22315b7">
<div class="org-src-container">
<pre class="src src-python"><span class="org-py-def-class">def</span> <span class="org-py-def">ret</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-def-class">def</span> <span class="org-py-def">monadic_value</span><span class="org-rainbow-delimiters-depth-1">()</span>:
    <span class="org-keyword">return</span> s
  <span class="org-keyword">return</span> monadic_value

<span class="org-py-def-class">def</span> <span class="org-py-def">bind</span><span class="org-rainbow-delimiters-depth-1">(</span>f<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-def-class">def</span> <span class="org-py-def">monadic_f</span><span class="org-rainbow-delimiters-depth-1">(</span>monadic_value<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-py-def-class">def</span> <span class="org-py-def">new_mv</span><span class="org-rainbow-delimiters-depth-1">()</span>:
      <span class="org-keyword">if</span> monadic_value<span class="org-rainbow-delimiters-depth-1">()</span>:
        <span class="org-keyword">return</span> f<span class="org-rainbow-delimiters-depth-1">(</span>monadic_value<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
      <span class="org-keyword">else</span>:
        <span class="org-keyword">return</span> <span class="org-py-pseudo-keyword">None</span>
    <span class="org-keyword">return</span> new_mv
  <span class="org-keyword">return</span> monadic_f

<span class="org-py-def-class">def</span> <span class="org-py-def">inc</span><span class="org-rainbow-delimiters-depth-1">(</span>x<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-keyword">return</span> x + <span class="org-py-number">1</span>

<span class="org-py-def-class">def</span> <span class="org-py-def">times_ten</span><span class="org-rainbow-delimiters-depth-1">(</span>x<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-keyword">return</span> x * <span class="org-py-number">10</span>

<span class="org-py-variable-name">mv</span> <span class="org-operator">=</span> ret<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-py-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-py-variable-name">m_inc</span> <span class="org-operator">=</span> bind<span class="org-rainbow-delimiters-depth-1">(</span>inc<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-py-variable-name">m_times_ten</span> <span class="org-operator">=</span> bind<span class="org-rainbow-delimiters-depth-1">(</span>times_ten<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-py-variable-name">one_result</span> <span class="org-operator">=</span> m_times_ten<span class="org-rainbow-delimiters-depth-1">(</span>m_inc<span class="org-rainbow-delimiters-depth-2">(</span>ret<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-py-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-py-variable-name">none_result</span> <span class="org-operator">=</span> m_times_ten<span class="org-rainbow-delimiters-depth-1">(</span>m_inc<span class="org-rainbow-delimiters-depth-2">(</span>ret<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-py-pseudo-keyword">None</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span>one_result<span class="org-rainbow-delimiters-depth-3">()</span>, none_result<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">[20, None]
</pre>
</div>

<p>
With the Maybe monad we gave our functions the capability to handle <code>None</code> as well as number values. This is a little clunky in regular Python, so we are going to introduce some Functional programming patterns:
</p>
<ul class="org-ul">
<li>Currying - Take a function with multiple arguments and "pre-fill" one or more of those arguments.</li>
<li>We can also get Python's operators such as <code>add</code> as functions from the <code>operator</code> package. This way we don't need to define all the intermediary functions like <code>inc</code>, <code>m_inc</code>, <code>m_times_ten</code>, etc.</li>
<li>We'll make a function that can compose a bunch of functions and then run them all. We'll call it <code>run</code>.</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span class="org-py-import-from">from</span> functools <span class="org-py-import-from">import</span> partial
<span class="org-py-import-from">from</span> operator <span class="org-py-import-from">import</span> *

<span class="org-comment-delimiter"># </span><span class="org-comment">The same as before, with lambda
</span><span class="org-py-def-class">def</span> <span class="org-py-def">ret</span><span class="org-rainbow-delimiters-depth-1">(</span>x<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-keyword">return</span> <span class="org-keyword">lambda</span>: x

<span class="org-comment-delimiter"># </span><span class="org-comment">The same as before, with lambda and python syntax sugar
</span><span class="org-py-def-class">def</span> <span class="org-py-def">bind</span><span class="org-rainbow-delimiters-depth-1">(</span>f<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-keyword">return</span> <span class="org-keyword">lambda</span> mv: <span class="org-keyword">lambda</span>: <span class="org-py-pseudo-keyword">None</span> <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-1">(</span>result := mv<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-keyword">is</span> <span class="org-py-pseudo-keyword">None</span> <span class="org-keyword">else</span> f<span class="org-rainbow-delimiters-depth-1">(</span>result<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">create the monadic value and then run the operations on it
</span><span class="org-py-def-class">def</span> <span class="org-py-def">run</span><span class="org-rainbow-delimiters-depth-1">(</span>operations, initial_value<span class="org-rainbow-delimiters-depth-1">)</span>:
  <span class="org-py-variable-name">v</span> <span class="org-operator">=</span> ret<span class="org-rainbow-delimiters-depth-1">(</span>initial_value<span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-keyword">for</span> op <span class="org-keyword">in</span> operations:
    <span class="org-py-variable-name">v</span> <span class="org-operator">=</span> bind<span class="org-rainbow-delimiters-depth-1">(</span>op<span class="org-rainbow-delimiters-depth-1">)(</span>v<span class="org-rainbow-delimiters-depth-1">)</span>
  <span class="org-keyword">return</span> v<span class="org-rainbow-delimiters-depth-1">()</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">some operations
</span><span class="org-py-variable-name">operations</span> <span class="org-operator">=</span> <span class="org-rainbow-delimiters-depth-1">[</span>partial<span class="org-rainbow-delimiters-depth-2">(</span>add, <span class="org-py-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>, 
              partial<span class="org-rainbow-delimiters-depth-2">(</span>mul, <span class="org-py-number">10</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>

<span class="org-py-builtins">print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span>run<span class="org-rainbow-delimiters-depth-3">(</span>operations, <span class="org-py-number">5</span><span class="org-rainbow-delimiters-depth-3">)</span>, run<span class="org-rainbow-delimiters-depth-3">(</span>operations, <span class="org-py-pseudo-keyword">None</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nil">[60, None]
</pre>
</div>
</div>
</div>
<div id="outline-container-org5b153fa" class="outline-3">
<h3 id="org5b153fa">Monad laws</h3>
<div class="outline-text-3" id="text-org5b153fa">
<p>
Monads must satisfy the monad laws. Without dwelling on the the technical language of the laws and just getting at their essence, these are satisfied by:
</p>
</div>
<div id="outline-container-org7868c51" class="outline-4">
<h4 id="org7868c51">ret is a left-identity for bind</h4>
<div class="outline-text-4" id="text-org7868c51">
<div class="org-src-container">
<pre class="src src-nil">bind(f)(ret(x))() == f(x)
</pre>
</div>

<p>
Binding the function f and passing it the monadic value of x, when all evaluated, is the same as the f(x).
</p>
</div>
</div>
<div id="outline-container-org6bfc21e" class="outline-4">
<h4 id="org6bfc21e">ret is also a right-identity for bind</h4>
<div class="outline-text-4" id="text-org6bfc21e">
<div class="org-src-container">
<pre class="src src-nil">bind(ret(x)) == ret(x)
</pre>
</div>
<p>
Binding the function which is the monadic value of x is the same as the monadic value of x
</p>
</div>
</div>
<div id="outline-container-org4e7d762" class="outline-4">
<h4 id="org4e7d762">bind is associative</h4>
<div class="outline-text-4" id="text-org4e7d762">
<div class="org-src-container">
<pre class="src src-nil">def h(x):
  return g(f(x))

bind(g)(bind(f)(ret(x))) == bind(h)(ret(x))
</pre>
</div>
<p>
It doesn't matter if we first compose g and f, and then bind, or bind and then compose, the result is the same.
</p>
</div>
</div>
</div>
<div id="outline-container-org4c0b91a" class="outline-3">
<h3 id="org4c0b91a">Objections</h3>
<div class="outline-text-3" id="text-org4c0b91a">
</div>
<div id="outline-container-org6eee175" class="outline-4">
<h4 id="org6eee175">This is still more complicated than just adding those extra capabilities by hand</h4>
<div class="outline-text-4" id="text-org6eee175">
<p>
Yes in this short example, but in a real world application it might end up as more concise. No silver bullet is offered.
</p>
</div>
</div>
<div id="outline-container-orge03fdf4" class="outline-4">
<h4 id="orge03fdf4">This is not pythonicâ„¢</h4>
<div class="outline-text-4" id="text-orge03fdf4">
<p>
Perhaps so, and this is for educational purposes only. No snakes were harmed in the creation of this article. Convention has its place, but there is also benefit to cross-pollination and trying new things. In the words of Ralph Waldo Emerson:
</p>

<blockquote>
<p>
"A foolish consistency is the hobgoblin of little minds."
</p>
</blockquote>
</div>
</div>
</div>
<div id="outline-container-org0d602b5" class="outline-3">
<h3 id="org0d602b5">What else can it do?</h3>
<div class="outline-text-3" id="text-org0d602b5">
<p>
Monads are a pretty useful design pattern, we can use them for all sorts of state, metadata, logging, side-effects. Basically anything where we want to write code as though we are just passing around and handling simple values with functions, but at the same time other stuff is going on "behind the scenes".
</p>
</div>
</div>
<div id="outline-container-org76e9574" class="outline-3">
<h3 id="org76e9574">Functional Python</h3>
<div class="outline-text-3" id="text-org76e9574">
<p>
<code>functools</code> and <code>itertools</code> open up a lot of possibilities for writing functional code in Python. Efficient, immutable data structures would also help with functional Python. are not native to Python but some attempts have been made by the community to introduce these via libraries, such as <a href="https://github.com/tobgu/pyrsistent">Pyrisistent</a>.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
