<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LZ</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type= "text/css" href="./styles.css"><link rel="icon"
       href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘»</text></svg>"><header>
<img src="/images/waveforms.png"
     style=width:30px;display:inline;">
| <a href="./">home</a>
| <a href="#top">top</a>
| <a href="https://github.com/larzeitlin">github</a>
|
</header>
</head>
<body>
<div id="content" class="content">
<h1 class="title">LZ</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org221cfb7">WebGL in ClojureScript - part one</a>
<ul>
<li><a href="#orgf4677c3">What is it?</a></li>
</ul>
</li>
<li><a href="#org45dd17a">Getting set up</a>
<ul>
<li><a href="#org9c28c6b">Canvas</a></li>
<li><a href="#org42ce93d">Setting the dimensions</a></li>
</ul>
</li>
<li><a href="#org98f1662">Shader program</a>
<ul>
<li><a href="#org05f71ea">Vertex Shader</a></li>
<li><a href="#org699a1e9">Fragment Shader</a></li>
<li><a href="#org707dde2">Program</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org221cfb7" class="outline-2">
<h2 id="org221cfb7">WebGL in ClojureScript - part one</h2>
<div class="outline-text-2" id="text-org221cfb7">
<p>
This is a tutorial in using webGL in ClojureScript, mainly for my own reference as I go through it, but if it helps someone else then that's fab too.
</p>
</div>

<div id="outline-container-orgf4677c3" class="outline-3">
<h3 id="orgf4677c3">What is it?</h3>
<div class="outline-text-3" id="text-orgf4677c3">
<p>
WebGL a graphics rendering API for JavaScript. It it based on OpenGL and it is GPU accelerated. Like OpenGL, webGL code is split between the shader code, which is generally run on the GPU and written in a dialect of C called GLSL, and the orchestration code. Below is a hello world-y basic project setup.
</p>
</div>
</div>
</div>

<div id="outline-container-org45dd17a" class="outline-2">
<h2 id="org45dd17a">Getting set up</h2>
<div class="outline-text-2" id="text-org45dd17a">
<p>
You have some CLJS project set up. I reccomend you have a running browser REPL connected to your editor so that you can have all the live coding, fast-feedback goodness of that.
</p>
</div>

<div id="outline-container-org9c28c6b" class="outline-3">
<h3 id="org9c28c6b">Canvas</h3>
<div class="outline-text-3" id="text-org9c28c6b">
<p>
We need a canvas element in the body of the html document. Give it an id so we can grab it. I called it <code>app</code> out of habit.
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #feacd0;">canvas</span> <span style="color: #00d3d0;">id</span>=<span style="color: #79a8ff;">"app"</span>&gt;&lt;/<span style="color: #feacd0;">canvas</span>&gt;
</pre>
</div>

<p>
Don't worry about the <code>width</code> and <code>height</code> for now. In clojure we are going to grab that and get a webgl context. We are just going to assume this is on a modern browser that supports it.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">def</span> <span style="color: #00d3d0;">c</span> <span style="color: #ff62d4;">(</span><span style="color: #6ae4b9;">js</span>/document.getElementById <span style="color: #79a8ff;">"app"</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">def</span> <span style="color: #00d3d0;">gl</span> <span style="color: #ff62d4;">(</span>.getContext c <span style="color: #79a8ff;">"webgl"</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>  
</pre>
</div>
</div>
</div>

<div id="outline-container-org42ce93d" class="outline-3">
<h3 id="org42ce93d">Setting the dimensions</h3>
<div class="outline-text-3" id="text-org42ce93d">
<p>
let's make a function to reset dimensions of both the canvas itself and the webgl context. Everything will be full window. We can call it whenever the window is resized.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">reset-dimensions</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>width <span style="color: #6ae4b9;">js</span>/window.innerWidth
        height <span style="color: #6ae4b9;">js</span>/window.innerHeight<span style="color: #3fdfd0;">]</span>
    <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/set c <span style="color: #79a8ff;">"width"</span> width<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/set c <span style="color: #79a8ff;">"height"</span> height<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span>.viewport gl 0 0 width height<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Okay let's stick it in a <code>-main</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">-main</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span>reset-dimensions<span style="color: #ff62d4;">)</span>
  <span style="color: #ff62d4;">(</span>.addEventListener <span style="color: #6ae4b9;">js</span>/window <span style="color: #79a8ff;">"resize"</span> reset-dimensions<span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org98f1662" class="outline-2">
<h2 id="org98f1662">Shader program</h2>
<div class="outline-text-2" id="text-org98f1662">
<p>
We will be making a <code>vertex shader</code> and a <code>fragment shader</code>. These two will be combined together into a <code>program</code>. We'll get into what these mean shortly. First we are going to make a convenience function that we can use to compile our shaders:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">create-shader</span> <span style="color: #ff62d4;">[</span>shader-type source<span style="color: #ff62d4;">]</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>shader <span style="color: #fba849;">(</span>.createShader gl shader-type<span style="color: #fba849;">)</span><span style="color: #3fdfd0;">]</span>
    <span style="color: #3fdfd0;">(</span>.shaderSource gl shader source<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span>.compileShader gl shader<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">js</span>/console.log
     <span style="color: #fba849;">(</span>str <span style="color: #79a8ff;">"compile shader: "</span>
          <span style="color: #9f80ff;">(</span>.getShaderParameter
           gl shader <span style="color: #4fe42f;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"COMPILE_STATUS"</span><span style="color: #4fe42f;">)</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span>
    shader<span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>
</div>

<div id="outline-container-org05f71ea" class="outline-3">
<h3 id="org05f71ea">Vertex Shader</h3>
<div class="outline-text-3" id="text-org05f71ea">
<p>
Our vertex shader's job is to set the the value of <code>gl_position</code> for each <code>vertex</code> that we want to draw. This one is basically just a pass-through, it doesn't do anything other than read an attribute and set <code>gl_position</code> with it.
</p>

<p>
We will just write the GLSL in a string. Could fetch it from a local file. This feels like less faff.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">def</span> <span style="color: #00d3d0;">vert-shader-source</span>
  <span style="color: #79a8ff;">"</span>
<span style="color: #79a8ff;">attribute vec4 a_position; </span>

<span style="color: #79a8ff;">void main() {</span>
<span style="color: #79a8ff;">  gl_Position = a_position;</span>
<span style="color: #79a8ff;">}</span>
<span style="color: #79a8ff;">"</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">vert-shader</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span>create-shader <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"VERTEX_SHADER"</span><span style="color: #3fdfd0;">)</span>
                 vert-shader-source<span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org699a1e9" class="outline-3">
<h3 id="org699a1e9">Fragment Shader</h3>
<div class="outline-text-3" id="text-org699a1e9">
<p>
The fragment shader sets the colour at each vertex. The space on a face in between the verticies will be interpolated between the vertex colours. In our case we are just going to set it to a fixed colour (r, g, b, a).
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">def</span> <span style="color: #00d3d0;">frag-shader-source</span>
  <span style="color: #79a8ff;">"</span>
<span style="color: #79a8ff;">precision mediump float;</span>

<span style="color: #79a8ff;">void main() {</span>
<span style="color: #79a8ff;">  gl_FragColor = vec4(1, 0, 0.5, 1);</span>
<span style="color: #79a8ff;">}</span>
<span style="color: #79a8ff;">"</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">frag-shader</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span>create-shader
   <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"FRAGMENT_SHADER"</span><span style="color: #3fdfd0;">)</span>
   frag-shader-source<span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org707dde2" class="outline-3">
<h3 id="org707dde2">Program</h3>
<div class="outline-text-3" id="text-org707dde2">
<p>
Now we build a program from our shaders.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">create-prog</span> <span style="color: #ff62d4;">[</span>vert frag<span style="color: #ff62d4;">]</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>program <span style="color: #fba849;">(</span>.createProgram gl<span style="color: #fba849;">)</span><span style="color: #3fdfd0;">]</span>
    <span style="color: #3fdfd0;">(</span>.attachShader gl program vert<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span>.attachShader gl program frag<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span>.linkProgram gl program<span style="color: #3fdfd0;">)</span>

    <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">js</span>/console.log
     <span style="color: #fba849;">(</span>str <span style="color: #79a8ff;">"link status: "</span>
          <span style="color: #9f80ff;">(</span>.getProgramParameter
           gl
           program
           <span style="color: #4fe42f;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"LINK_STATUS"</span><span style="color: #4fe42f;">)</span><span style="color: #9f80ff;">)</span><span style="color: #fba849;">)</span><span style="color: #3fdfd0;">)</span>

    <span style="color: #65737e; font-style: italic;">;; </span><span style="color: #a8a8a8; font-style: italic;">return</span>
    program<span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
We can now add the program to the <code>-main</code> function:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">-main</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span>.addEventListener <span style="color: #6ae4b9;">js</span>/window
                     <span style="color: #79a8ff;">"resize"</span>
                     reset-dimensions<span style="color: #ff62d4;">)</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>vs <span style="color: #fba849;">(</span>vert-shader<span style="color: #fba849;">)</span>
        fs <span style="color: #fba849;">(</span>frag-shader<span style="color: #fba849;">)</span>
        prog <span style="color: #fba849;">(</span>create-prog vs fs<span style="color: #fba849;">)</span><span style="color: #3fdfd0;">]</span>
    <span style="color: #3fdfd0;">(</span>reset-dimensions<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
We are going to draw a triangle. To do this we need some verticies. x and y coordinates go from 1 (top and left) to -1 (bottom and right). Let's add an array of 3 verticies x and then y coordinates, like so:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">-main</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span>.addEventListener <span style="color: #6ae4b9;">js</span>/window
                     <span style="color: #79a8ff;">"resize"</span>
                     reset-dimensions<span style="color: #ff62d4;">)</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>vs <span style="color: #fba849;">(</span>vert-shader<span style="color: #fba849;">)</span>
        fs <span style="color: #fba849;">(</span>frag-shader<span style="color: #fba849;">)</span>
        prog <span style="color: #fba849;">(</span>create-prog vs fs<span style="color: #fba849;">)</span>
        points <span style="color: #fba849;">[</span>0 0 0 0.5 0.7 1<span style="color: #fba849;">]</span><span style="color: #3fdfd0;">]</span>
    <span style="color: #3fdfd0;">(</span>reset-dimensions<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
We need these points to go to the <code>a_position</code> attribute that we added to the vertex shader above. To do that we need an object to store the memory, this is called a <code>buffer</code>. We then need to bind this buffer toa <code>target</code> called <code>ARRAY_BUFFER</code>, used for vertex data. Once we have bound we will buffer the data. <code>STATIC_DRAW</code> is a hint to the compiler for optimizations based on what we are trying to do. Let's add some more helper functions to take care of this. We also want a function to clear the canvas.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript">
<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">bind-pos-buff</span> <span style="color: #ff62d4;">[</span>pos-buff<span style="color: #ff62d4;">]</span>
  <span style="color: #ff62d4;">(</span>.bindBuffer gl
               <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"ARRAY_BUFFER"</span><span style="color: #3fdfd0;">)</span>
               pos-buff<span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">buffer-static-draw</span> <span style="color: #ff62d4;">[</span>points<span style="color: #ff62d4;">]</span>
  <span style="color: #ff62d4;">(</span>.bufferData gl
               <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"ARRAY_BUFFER"</span><span style="color: #3fdfd0;">)</span>
               <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">js</span>/Float32Array. points<span style="color: #3fdfd0;">)</span>
               <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"STATIC_DRAW"</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">set-vertex-attrib-pointer</span> <span style="color: #ff62d4;">[</span>pos-attr-loc<span style="color: #ff62d4;">]</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>size 2
        dtype <span style="color: #fba849;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"FLOAT"</span><span style="color: #fba849;">)</span>
        normalize? <span style="color: #00bcff;">false</span>
        stride 0
        offset 0<span style="color: #3fdfd0;">]</span>
    <span style="color: #3fdfd0;">(</span>.vertexAttribPointer gl
                          pos-attr-loc
                          size
                          dtype
                          normalize?
                          stride
                          offset<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">draw-triangles</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>prim-type <span style="color: #fba849;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"TRIANGLES"</span><span style="color: #fba849;">)</span>
        offset 0
        cnt 3<span style="color: #3fdfd0;">]</span>
    <span style="color: #3fdfd0;">(</span>.drawArrays gl prim-type offset cnt<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>

<span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">clear</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span>.clearColor gl 0 0 0 1<span style="color: #ff62d4;">)</span>
  <span style="color: #ff62d4;">(</span>.clear gl <span style="color: #3fdfd0;">(</span><span style="color: #6ae4b9;">g</span>/get gl <span style="color: #79a8ff;">"COLOR_BUFFER_BIT"</span><span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
Let's call these from our -<code>main</code> fn.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #ffffff;">(</span><span style="color: #b6a0ff;">defn</span> <span style="color: #feacd0;">-main</span> <span style="color: #ff62d4;">[]</span>
  <span style="color: #ff62d4;">(</span>.addEventListener <span style="color: #6ae4b9;">js</span>/window
                     <span style="color: #79a8ff;">"resize"</span>
                     reset-dimensions<span style="color: #ff62d4;">)</span>
  <span style="color: #ff62d4;">(</span><span style="color: #b6a0ff;">let</span> <span style="color: #3fdfd0;">[</span>vs <span style="color: #fba849;">(</span>vert-shader<span style="color: #fba849;">)</span>
        fs <span style="color: #fba849;">(</span>frag-shader<span style="color: #fba849;">)</span>
        prog <span style="color: #fba849;">(</span>create-prog vs fs<span style="color: #fba849;">)</span>
        pos-attr-loc <span style="color: #fba849;">(</span>.getAttribLocation
                      gl
                      prog
                      <span style="color: #79a8ff;">"a_position"</span><span style="color: #fba849;">)</span>
        pos-buff <span style="color: #fba849;">(</span>.createBuffer gl<span style="color: #fba849;">)</span>
        points <span style="color: #fba849;">[</span>0 0 0 0.5 0.7 1.0<span style="color: #fba849;">]</span><span style="color: #3fdfd0;">]</span>   
    <span style="color: #3fdfd0;">(</span>reset-dimensions<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span>clear<span style="color: #3fdfd0;">)</span>
    <span style="color: #3fdfd0;">(</span>bind-pos-buff pos-buff<span style="color: #3fdfd0;">)</span>    <span style="color: #65737e; font-style: italic;">;; </span><span style="color: #a8a8a8; font-style: italic;">point pos-buff at ARRAY_BUFFER   </span>
    <span style="color: #3fdfd0;">(</span>buffer-static-draw points<span style="color: #3fdfd0;">)</span> <span style="color: #65737e; font-style: italic;">;; </span><span style="color: #a8a8a8; font-style: italic;">buffer the data</span>
    <span style="color: #3fdfd0;">(</span>.useProgram gl prog<span style="color: #3fdfd0;">)</span>       <span style="color: #65737e; font-style: italic;">;; </span><span style="color: #a8a8a8; font-style: italic;">envoke our shader program</span>
    <span style="color: #3fdfd0;">(</span>.enableVertexAttribArray gl pos-attr-loc<span style="color: #3fdfd0;">)</span> <span style="color: #65737e; font-style: italic;">;; </span><span style="color: #a8a8a8; font-style: italic;">enable a_position attribute</span>
    <span style="color: #3fdfd0;">(</span>set-vertex-attrib-pointer pos-attr-loc<span style="color: #3fdfd0;">)</span>   <span style="color: #65737e; font-style: italic;">;; </span><span style="color: #a8a8a8; font-style: italic;">tell webgl how to handle the points data</span>
    <span style="color: #3fdfd0;">(</span>draw-triangles<span style="color: #3fdfd0;">)</span><span style="color: #ff62d4;">)</span><span style="color: #ffffff;">)</span>
</pre>
</div>

<p>
This should give you a pink triangle.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
