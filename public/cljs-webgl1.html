<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LZ</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type= "text/css" href="./htmlize.css"><link rel="stylesheet" type= "text/css" href="./styles.css"><link rel="icon"
       href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘»</text></svg>"><header>
| <a href="./">home</a>
| <a href="#top">top</a>
| <a href="https://github.com/larzeitlin">github</a>
|
</header>
</head>
<body>
<div id="content" class="content">
<h1 class="title">LZ</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc006560">WebGL in ClojureScript - part one</a>
<ul>
<li><a href="#org7bdd210">What is it?</a></li>
</ul>
</li>
<li><a href="#orgda84ff7">Getting set up</a>
<ul>
<li><a href="#org431bb83">Canvas</a></li>
<li><a href="#org464116c">Setting the dimensions</a></li>
</ul>
</li>
<li><a href="#org1f415f8">Shader program</a>
<ul>
<li><a href="#org4ada192">Vertex Shader</a></li>
<li><a href="#org16e458b">Fragment Shader</a></li>
<li><a href="#orgeeac03c">Program</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgc006560" class="outline-2">
<h2 id="orgc006560">WebGL in ClojureScript - part one</h2>
<div class="outline-text-2" id="text-orgc006560">
<p>
This is a tutorial in using webGL in ClojureScript, mainly for my own reference as I go through it, but if it helps someone else then that's fab too.
</p>
</div>
<div id="outline-container-org7bdd210" class="outline-3">
<h3 id="org7bdd210">What is it?</h3>
<div class="outline-text-3" id="text-org7bdd210">
<p>
WebGL a graphics rendering API for JavaScript. It it based on OpenGL and it is GPU accelerated. Like OpenGL, webGL code is split between the shader code, which is generally run on the GPU and written in a dialect of C called GLSL, and the orchestration code. Below is a hello world-y basic project setup.
</p>
</div>
</div>
</div>
<div id="outline-container-orgda84ff7" class="outline-2">
<h2 id="orgda84ff7">Getting set up</h2>
<div class="outline-text-2" id="text-orgda84ff7">
<p>
You have some CLJS project set up. I reccomend you have a running browser REPL connected to your editor so that you can have all the live coding, fast-feedback goodness of that.
</p>
</div>
<div id="outline-container-org431bb83" class="outline-3">
<h3 id="org431bb83">Canvas</h3>
<div class="outline-text-3" id="text-org431bb83">
<p>
We need a canvas element in the body of the html document. Give it an id so we can grab it. I called it <code>app</code> out of habit.
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span class="org-function-name">canvas</span> <span class="org-variable-name">id</span>=<span class="org-string">"app"</span>&gt;&lt;/<span class="org-function-name">canvas</span>&gt;
</pre>
</div>

<p>
Don't worry about the <code>width</code> and <code>height</code> for now. In clojure we are going to grab that and get a webgl context. We are just going to assume this is on a modern browser that supports it.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">c</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">js</span>/document.getElementById <span class="org-string">"app"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">gl</span> <span class="org-rainbow-delimiters-depth-2">(</span>.getContext c <span class="org-string">"webgl"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>  
</pre>
</div>
</div>
</div>
<div id="outline-container-org464116c" class="outline-3">
<h3 id="org464116c">Setting the dimensions</h3>
<div class="outline-text-3" id="text-org464116c">
<p>
let's make a function to reset dimensions of both the canvas itself and the webgl context. Everything will be full window. We can call it whenever the window is resized.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">reset-dimensions</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>width <span class="org-type">js</span>/window.innerWidth
        height <span class="org-type">js</span>/window.innerHeight<span class="org-rainbow-delimiters-depth-3">]</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/set c <span class="org-string">"width"</span> width<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/set c <span class="org-string">"height"</span> height<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.viewport gl 0 0 width height<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Okay let's stick it in a <code>-main</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">-main</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>reset-dimensions<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.addEventListener <span class="org-type">js</span>/window <span class="org-string">"resize"</span> reset-dimensions<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1f415f8" class="outline-2">
<h2 id="org1f415f8">Shader program</h2>
<div class="outline-text-2" id="text-org1f415f8">
<p>
We will be making a <code>vertex shader</code> and a <code>fragment shader</code>. These two will be combined together into a <code>program</code>. We'll get into what these mean shortly. First we are going to make a convenience function that we can use to compile our shaders:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">create-shader</span> <span class="org-rainbow-delimiters-depth-2">[</span>shader-type source<span class="org-rainbow-delimiters-depth-2">]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>shader <span class="org-rainbow-delimiters-depth-4">(</span>.createShader gl shader-type<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.shaderSource gl shader source<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.compileShader gl shader<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">js</span>/console.log
     <span class="org-rainbow-delimiters-depth-4">(</span>str <span class="org-string">"compile shader: "</span>
          <span class="org-rainbow-delimiters-depth-5">(</span>.getShaderParameter
           gl shader <span class="org-rainbow-delimiters-depth-6">(</span><span class="org-type">g</span>/get gl <span class="org-string">"COMPILE_STATUS"</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    shader<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
<div id="outline-container-org4ada192" class="outline-3">
<h3 id="org4ada192">Vertex Shader</h3>
<div class="outline-text-3" id="text-org4ada192">
<p>
Our vertex shader's job is to set the the value of <code>gl_position</code> for each <code>vertex</code> that we want to draw. This one is basically just a pass-through, it doesn't do anything other than read an attribute and set <code>gl_position</code> with it.
</p>

<p>
We will just write the GLSL in a string. Could fetch it from a local file. This feels like less faff.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">vert-shader-source</span>
  <span class="org-string">"
attribute vec4 a_position; 

void main() {
  gl_Position = a_position;
}
"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">vert-shader</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>create-shader <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/get gl <span class="org-string">"VERTEX_SHADER"</span><span class="org-rainbow-delimiters-depth-3">)</span>
                 vert-shader-source<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org16e458b" class="outline-3">
<h3 id="org16e458b">Fragment Shader</h3>
<div class="outline-text-3" id="text-org16e458b">
<p>
The fragment shader sets the colour at each vertex. The space on a face in between the verticies will be interpolated between the vertex colours. In our case we are just going to set it to a fixed colour (r, g, b, a).
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">def</span> <span class="org-variable-name">frag-shader-source</span>
  <span class="org-string">"
precision mediump float;

void main() {
  gl_FragColor = vec4(1, 0, 0.5, 1);
}
"</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">frag-shader</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>create-shader
   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/get gl <span class="org-string">"FRAGMENT_SHADER"</span><span class="org-rainbow-delimiters-depth-3">)</span>
   frag-shader-source<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeeac03c" class="outline-3">
<h3 id="orgeeac03c">Program</h3>
<div class="outline-text-3" id="text-orgeeac03c">
<p>
Now we build a program from our shaders.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">create-prog</span> <span class="org-rainbow-delimiters-depth-2">[</span>vert frag<span class="org-rainbow-delimiters-depth-2">]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>program <span class="org-rainbow-delimiters-depth-4">(</span>.createProgram gl<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.attachShader gl program vert<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.attachShader gl program frag<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.linkProgram gl program<span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">js</span>/console.log
     <span class="org-rainbow-delimiters-depth-4">(</span>str <span class="org-string">"link status: "</span>
          <span class="org-rainbow-delimiters-depth-5">(</span>.getProgramParameter
           gl
           program
           <span class="org-rainbow-delimiters-depth-6">(</span><span class="org-type">g</span>/get gl <span class="org-string">"LINK_STATUS"</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-comment-delimiter">;; </span><span class="org-comment">return
</span>    program<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
We can now add the program to the <code>-main</code> function:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">-main</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.addEventListener <span class="org-type">js</span>/window
                     <span class="org-string">"resize"</span>
                     reset-dimensions<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>vs <span class="org-rainbow-delimiters-depth-4">(</span>vert-shader<span class="org-rainbow-delimiters-depth-4">)</span>
        fs <span class="org-rainbow-delimiters-depth-4">(</span>frag-shader<span class="org-rainbow-delimiters-depth-4">)</span>
        prog <span class="org-rainbow-delimiters-depth-4">(</span>create-prog vs fs<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>reset-dimensions<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
We are going to draw a triangle. To do this we need some verticies. x and y coordinates go from 1 (top and left) to -1 (bottom and right). Let's add an array of 3 verticies x and then y coordinates, like so:
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">-main</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.addEventListener <span class="org-type">js</span>/window
                     <span class="org-string">"resize"</span>
                     reset-dimensions<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>vs <span class="org-rainbow-delimiters-depth-4">(</span>vert-shader<span class="org-rainbow-delimiters-depth-4">)</span>
        fs <span class="org-rainbow-delimiters-depth-4">(</span>frag-shader<span class="org-rainbow-delimiters-depth-4">)</span>
        prog <span class="org-rainbow-delimiters-depth-4">(</span>create-prog vs fs<span class="org-rainbow-delimiters-depth-4">)</span>
        points <span class="org-rainbow-delimiters-depth-4">[</span>0 0 0 0.5 0.7 1<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">]</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>reset-dimensions<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
We need these points to go to the <code>a_position</code> attribute that we added to the vertex shader above. To do that we need an object to store the memory, this is called a <code>buffer</code>. We then need to bind this buffer toa <code>target</code> called <code>ARRAY_BUFFER</code>, used for vertex data. Once we have bound we will buffer the data. <code>STATIC_DRAW</code> is a hint to the compiler for optimizations based on what we are trying to do. Let's add some more helper functions to take care of this. We also want a function to clear the canvas.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript">
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">bind-pos-buff</span> <span class="org-rainbow-delimiters-depth-2">[</span>pos-buff<span class="org-rainbow-delimiters-depth-2">]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.bindBuffer gl
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/get gl <span class="org-string">"ARRAY_BUFFER"</span><span class="org-rainbow-delimiters-depth-3">)</span>
               pos-buff<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">buffer-static-draw</span> <span class="org-rainbow-delimiters-depth-2">[</span>points<span class="org-rainbow-delimiters-depth-2">]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.bufferData gl
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/get gl <span class="org-string">"ARRAY_BUFFER"</span><span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">js</span>/Float32Array. points<span class="org-rainbow-delimiters-depth-3">)</span>
               <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/get gl <span class="org-string">"STATIC_DRAW"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">set-vertex-attrib-pointer</span> <span class="org-rainbow-delimiters-depth-2">[</span>pos-attr-loc<span class="org-rainbow-delimiters-depth-2">]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>size 2
        dtype <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">g</span>/get gl <span class="org-string">"FLOAT"</span><span class="org-rainbow-delimiters-depth-4">)</span>
        normalize? <span class="org-constant">false</span>
        stride 0
        offset 0<span class="org-rainbow-delimiters-depth-3">]</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.vertexAttribPointer gl
                          pos-attr-loc
                          size
                          dtype
                          normalize?
                          stride
                          offset<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">draw-triangles</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>prim-type <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">g</span>/get gl <span class="org-string">"TRIANGLES"</span><span class="org-rainbow-delimiters-depth-4">)</span>
        offset 0
        cnt 3<span class="org-rainbow-delimiters-depth-3">]</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>.drawArrays gl prim-type offset cnt<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">clear</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.clearColor gl 0 0 0 1<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.clear gl <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">g</span>/get gl <span class="org-string">"COLOR_BUFFER_BIT"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Let's call these from our -<code>main</code> fn.
</p>

<div class="org-src-container">
<pre class="src src-clojurescript"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defn</span> <span class="org-function-name">-main</span> <span class="org-rainbow-delimiters-depth-2">[]</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>.addEventListener <span class="org-type">js</span>/window
                     <span class="org-string">"resize"</span>
                     reset-dimensions<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">[</span>vs <span class="org-rainbow-delimiters-depth-4">(</span>vert-shader<span class="org-rainbow-delimiters-depth-4">)</span>
        fs <span class="org-rainbow-delimiters-depth-4">(</span>frag-shader<span class="org-rainbow-delimiters-depth-4">)</span>
        prog <span class="org-rainbow-delimiters-depth-4">(</span>create-prog vs fs<span class="org-rainbow-delimiters-depth-4">)</span>
        pos-attr-loc <span class="org-rainbow-delimiters-depth-4">(</span>.getAttribLocation
                      gl
                      prog
                      <span class="org-string">"a_position"</span><span class="org-rainbow-delimiters-depth-4">)</span>
        pos-buff <span class="org-rainbow-delimiters-depth-4">(</span>.createBuffer gl<span class="org-rainbow-delimiters-depth-4">)</span>
        points <span class="org-rainbow-delimiters-depth-4">[</span>0 0 0 0.5 0.7 1.0<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">]</span>   
    <span class="org-rainbow-delimiters-depth-3">(</span>reset-dimensions<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>clear<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>bind-pos-buff pos-buff<span class="org-rainbow-delimiters-depth-3">)</span>    <span class="org-comment-delimiter">;; </span><span class="org-comment">point pos-buff at ARRAY_BUFFER   
</span>    <span class="org-rainbow-delimiters-depth-3">(</span>buffer-static-draw points<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">buffer the data
</span>    <span class="org-rainbow-delimiters-depth-3">(</span>.useProgram gl prog<span class="org-rainbow-delimiters-depth-3">)</span>       <span class="org-comment-delimiter">;; </span><span class="org-comment">envoke our shader program
</span>    <span class="org-rainbow-delimiters-depth-3">(</span>.enableVertexAttribArray gl pos-attr-loc<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">;; </span><span class="org-comment">enable a_position attribute
</span>    <span class="org-rainbow-delimiters-depth-3">(</span>set-vertex-attrib-pointer pos-attr-loc<span class="org-rainbow-delimiters-depth-3">)</span>   <span class="org-comment-delimiter">;; </span><span class="org-comment">tell webgl how to handle the points data
</span>    <span class="org-rainbow-delimiters-depth-3">(</span>draw-triangles<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
This should give you a pink triangle.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
